### 스레드 동기화

멀티스레드는 다수의 잡업을 동시에 실행시키는 응용프로그램 작성 기법이다.
하지만 다수의 스레드가 공유자원 혹은 공유데이터에 동시에 접급할때 문제점이 생길 수 있다.
멀티스레드 프로그램을 작성할대 주의할 점은 다수의 스레드가 공유데이터에 동시 접근하는 경우에 대한 처리이다.
이에대한 해결책이 바로 스레드 동기화이다.

스레드 동기화란 공유 데이터에 접근하고자 하는 다수의 스레드가 서로 순서대로 충돌없이 공유데이터를 베타적으로 접근하기 위해 상호 협력하는 것을 말한다.
공유데이터는 배타적이고, 독점적으로 이루어져야 하며, 독점적으로 공유데이터를 달는 프로그램 코드를 임계영역이라고 부른다.

synchronized로 동기화 블록을 지정하는 방법과 wait()-notify()메소드로 스레드 실행 순서를 제어하는 방법이 있다.


### synchronized

스레드가 공유데이터를 접근할때, 하나씩 순차적으로 실행하도록 제어하는 기법이다.
한 스레드가 공유데이터의 접근을 시작한 순간, 데이터를 lock하고 다른 스레드가 대기하도록 한다.

synchronzed 키워드는 스레드 동기화를 위한 장치로 임의 코드드블록을 동기화가 설저오딘 임계영역으로 지정하낟.
임계영역으로 지정하는 방법은 2가지가 있는데 어떤 방법을 사용하던지 synchronized블록은 진입할때는 lock빠져나올때 unlock동작이 자동으로 이루어지도록 컴파일된다.
먼저 동기화영역에 들어온 스레드가 lock을 거렁 소유하고 있으면, lock을 소유하지 못한 다른 스레드는 synchronized블록앞에서 lock을 소유할때까지 대기한다.


### 메소드 전체를 synchronized

```java
synchonized void add(){
  int n=getCurrentSum();
  setCurrentSum(n);
  }
```

이와같이 synchronized를 하게되면 add()메소드를 임계영역으로 지정한다.
add()메소드가 호출되면 자동으로 동기화된다. 한 스레드가 add()메소드를호출하여 실행하고 있는 도웆ㅇ에 다른 스레드가 add()메소드를 호출하면, 
이 스레드는 첫번째 스레드가 add()실행을 마치고 완전히 빠져나오기 까지 자동으로 대기하게 된다.


### 코드브록을 synchoronized

```java
void execute(){
synchronized(this){
  int n=getCurrentSum();
  n+=10;
  setCurrentSum(n);
  }
}
```

한 스레드가 synchronized블록내의 코드를 실해하고 있을때 다른 스레드가 이 블록을 실행하고자 하면 먼저 실행중인 스레드가 실행을 마칠때까지
자동으로 대기한다.
this는 블록에서 인자로 주어진 객체(this)와 연계된 락(lock)을 사용하도록 개발자가 지정한 것이다.
개발자는 this대신 다른 객체의 레퍼런스를 사용할 수 있고, 그 객체가 lock과 연관된다.


![image](https://user-images.githubusercontent.com/80390524/131844706-84a05a0f-0e2e-44d6-9058-d922e03bf2c5.png)


### wait()-notify()를 이요한 스레드동기화가 필요한 경우

synchronized를 이용하여 공유데이터에 순차적으로 잘 접근하도록 만들어진 경우라고, 여전히 동기화가 필요한 살황이 있다.
대표적으로 공유 메모리를 통해 두 스레드가 데이터를 주고 받을때 공유 메모리에 대해 두 스레드가 동시에 접근하는 producer-customer문제이다.

java.lang.Object클래스는 스레드 사이에 동기화를 위한 3개의 메소드 wait(), nltify(),notifyAll()를 제공한다.
모든 객체는 object클래스를 상속받기 때문에, 자바는 모든 객체가 동기화 객체가 될 수 있도록 설계하였다.

* wait()
> 다른 스레드가 이 객체의notify()를 불러줄때까지 대기한다.
* notify()
> 이 객체에 대기중인 스레드를 깨워RUNNABLE 상태로 만든다.
> 두개 이상의 스레드가 대기중이라도 오직 한개의 스레드만깨워 RUNNABLE상태로 한다.
* notifyAll()
> 이 객체에 대기중인 모든 스레드를 깨우고 모드 RUNNABLE 상태로 한다.

